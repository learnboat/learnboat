<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="shortcut icon" href="lib/assets/images/people/yang.svg">
    <!-- 引入样式 -->
    <title>学乐之舟</title>


    <!-- 引入样式 -->
    <link href="../../lib/elementui/index.css" rel="stylesheet">
    <script src="../../lib/js/tailwind4-3.js"></script>
    <style>
        [v-cloak] {
            display: none;
        }
    </style>
<body class="bg-gray-50">

<div id="app" class="" v-cloak>

    <!--    从官网的例子-->
    <header class="bg-[#3f3f46] text-white">
        <nav class="mx-auto flex max-w-7xl items-start  p-5 md:px-8" aria-label="Global">
            <div class="flex md:flex-1">
                <a href="#" class="-m-1.5 p-1.5">
                    <span class="sr-only">Your Company</span>
                    <!--                    <img class="h-8 w-auto" src="https://tailwindui.com/img/logos/mark.svg?color=indigo&shade=600" alt="">-->
                </a>
            </div>

            <div class="hidden md:flex md:gap-x-12">

                <a href="#" class="text-lg font-semibold leading-6 text-white tracking-widest ">活动</a>
                <a href="#" class="text-lg font-semibold leading-6 text-white tracking-widest">项目</a>
                <a href="#" class="text-lg font-semibold leading-6 text-white tracking-widest">个人中心</a>
            </div>
            <div class="hidden md:flex md:flex-1 md:justify-end">
                <a href="#" class="text-sm font-semibold leading-6 text-white">Log in <span
                        aria-hidden="true">&rarr;</span></a>
            </div>
            <div class=" md:hidden  flex flex-1  justify-end">
                <a href="#" class="text-sm font-semibold leading-6 text-white">
                    <img class="h-5 w-auto" src="lib/assets/images/baseConponetPic/menuright.svg" alt="">
                </a>
            </div>
        </nav>
        <!-- Mobile menu, show/hide based on menu open state. -->
        <div class="hidden" role="dialog" aria-modal="true">
            <!-- Background backdrop, show/hide based on slide-over state. -->
            <div class="fixed inset-0 z-10"></div>
            <div class="fixed inset-y-0 right-0 z-10 w-[80%] overflow-y-auto bg-[#3f3f46] px-6 py-6 sm:max-w-sm sm:ring-1 sm:ring-gray-900/10">
                <div class="flex items-center justify-between">
                    <a href="#" class="-m-1.5 p-1.5">
                        <span class="sr-only">Your Company</span>
                        <img class="h-8 w-auto" src="https://tailwindui.com/img/logos/mark.svg?color=indigo&shade=600"
                             alt="">
                    </a>
                    <button type="button" class="-m-2.5 rounded-md p-2.5 text-white">
                        <span class="sr-only">Close menu</span>
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                             aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="mt-6 flow-root">
                    <div class="-my-6 divide-y divide-gray-500/10">
                        <div class="space-y-2 py-6">

                            <a href="#"
                               class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-white hover:bg-gray-50 hover:text-black">Features</a>
                            <a href="#"
                               class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-white hover:bg-gray-50 hover:text-black">Marketplace</a>
                            <a href="#"
                               class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-white hover:bg-gray-50 hover:text-black">Company</a>
                        </div>
                        <div class="py-6">
                            <a href="#"
                               class="-mx-3 block rounded-lg px-3 py-2.5 text-base font-semibold leading-7 text-white hover:bg-gray-50 hover:text-black">Log
                                in</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主体 -->
    <div class="w-full bg-gray-50 flex justify-center">

        <!--        主体-->
        <div class="w-full md:w-[70%] 2xl:w-[55%]   grid grid-cols-12  ">
            <!--            左边-->
            <div class="hidden md:grid md:col-span-4 m-3  bg-white rounded-lg">
                <div class="text-sm text-gray-300">
                    <div class="text-sm text-gray-300 p-3 flex justify-start">
                        <img src="../../lib/assets/images/baseConponetPic/managezuobian.svg" alt=""
                             class="w-[20px] h-[20px]">
                        <p class="ml-2">时间管理</p>
                    </div>
                    <div class="text-lg text-gray-600 hover:bg-gray-200 rounded-lg p-3">
                        <p class="ml-10">番茄时钟</p>
                    </div>

                </div>
            </div>

            <div class="grid col-span-12 md:grid md:col-span-8  p-5 ">

                <el-breadcrumb class="mt-2 " separator="/">
                    <el-breadcrumb-item><a href="./fanqielist.html">番茄列表</a></el-breadcrumb-item>
                    <el-breadcrumb-item>番茄时钟</el-breadcrumb-item>
                </el-breadcrumb>

                <div class="flex justify-center mt-2">

                    <div class="r_out">

                        <div class="r_in">

                            <div class="r_c c1" v-show="clockstatus==1 || clockstatus==2"></div>
                            <div class="r_c c2" v-show="clockstatus==3"></div>
                            <div class="r_num">{{timeshow}}</div>

                        </div>

                    </div>

                </div>
                <div class="flex justify-center">
                    <button @click="startCount" v-show="clockstatus==1"
                            class="bg-blue-500 text-white text-2xl  font-bold  rounded-full w-[200px] h-[60px] mt-5">
                        开始
                    </button>
                    <button @click="startCount" v-show="clockstatus==2"
                            class="bg-orange-500 text-white text-2xl  font-bold  rounded-full w-[200px] h-[60px] mt-5">
                        结束
                    </button>
                    <button @click="startCount" v-show="clockstatus==3"
                            class="bg-green-500 text-white text-2xl  font-bold  rounded-full w-[200px] h-[60px] mt-5">
                        停止休息
                    </button>
                </div>

                <div class="flex justify-start mt-5">
                    <p class="text-gray-700 mt-1">目标:</p>
                    <el-input :disabled="titleDisabled" class="w-[80%] ml-2" v-model="inputContent"
                              placeholder="请输入内容"></el-input>
                </div>
                <div class="flex justify-start mt-5">
                    <p class="text-gray-700 mt-1">番茄时间(分钟):</p>
                    <el-input-number :disabled="countDisable" class=" ml-2" v-model="workTimeNum"
                                     @change="workTimeNumHandleChange"
                                     :min="workmin" :max="workmax" :step="workstep"
                                     label="描述文字"></el-input-number>
                </div>
                <div class="flex justify-start mt-5">
                    <p class="text-gray-700 mt-1">休息时间(分钟):</p>
                    <el-input-number :disabled="countDisable" class=" ml-2" v-model="restNum"
                                     @change="restNumHandleChange" :min="restmin"
                                     :max="restmax" :step="reststep"
                                     label="描述文字"></el-input-number>
                </div>

                <div class="mt-5" v-for="it in fullFanqieList">
                    <div class="h-[1px] w-[100%] bg-gray-200"></div>
                    <h2 class="text-gray-500 mt-2">
                        {{it.title}}:
                    </h2>
                    <p class=" mt-2" style="word-wrap: break-word">
                    <div v-for="it00 in it.list" class="inlineblock">
                        <div v-if="it00 == 1" class="w-[50px] h-[50px]  " style="background-image: url('../../lib/assets/images/baseConponetPic/fanqielogo.svg'); background-size: cover;
                                               "></div>
                        <div v-if="it00 == 0" class="w-[50px] h-[50px] " style="background-image: url('../../lib/assets/images/baseConponetPic/lanfanqielogo.svg'); background-size: cover;
                                               "></div>
                    </div>

                    </p>
                    <div class="mt-2">
                        番茄时间共：{{it.fanqietotal}}分钟
                    </div>
                    <div>
                        烂番茄时间：{{it.lantotal}}分钟
                    </div>

                </div>


            </div>

        </div>

    </div>


</div>


</div>

<script type="text/javascript" src="../../lib/js/jquery-1.11.0.min.js"></script>

<script src="../../lib/js/tailwind4-3.js"></script>
<script src="../../lib/vue/vue.js"></script>
<script src="../../lib/elementui/index.js"></script>
<script src="../../lib/axios/axios.js"></script>
<script src="../../lib/js/common.js"></script>
<script src="../../lib/js/sweetalert2.js"></script>

<script type="text/javascript">

    var timer;

    new Vue({
        el: "#app",
        data: {
            token: getLocalStorage("token"),
            baseUrl: GetBaseUrl(),
            workmin: 15,
            workmax: 45,
            workstep: 5,
            workTimeNum: 25,
            restNum: 5,
            restmin: 5,
            restmax: 20,
            reststep: 1,
            inputContent: '',
            totalSeconds: 1500,
            timeshow: '25:00',
            clockstatus: 1,  //1：正式开始前 2：正式开始 3：休息中
            nowFanqieList: {
                title: '',
                list: [],
                fanqietotal: 0,
                lantotal: 0
            },
            fullFanqieList: [],
            titleDisabled: false,
            countDisable: false,
        },
        methods: {
            workTimeNumHandleChange(value) {
                this.timeshow = value + ":00"
            },
            restNumHandleChange(value) {

            },
            updateWorkCountdown() {

                var minutes = Math.floor(this.totalSeconds / 60); // 计算分钟数
                var seconds = this.totalSeconds % 60; // 计算剩余的秒数
                // 确保秒数是两位数
                seconds = seconds < 10 ? '0' + seconds : seconds;
                // 更新页面上的显示
                minutes = minutes < 10 ? '0' + minutes : minutes;
                this.timeshow = minutes + ':' + seconds;
                let persent = (this.workTimeNum * 60 - this.totalSeconds) * 100 / (this.workTimeNum * 60)
                $(".c1").animate({
                    height: persent + "%"
                }, 0);
                // 减少总秒数
                this.totalSeconds--;
                // 如果倒计时结束，可以清除定时器或进行其他操作
                if (this.totalSeconds < 0) {
                    clearInterval(timer);
                    // 这里可以添加倒计时结束后的处理逻辑
                    //todo 请求后端
                    //

                    //获取最新一个
                    this.nowFanqieList = this.fullFanqieList[this.fullFanqieList.length - 1]

                    this.nowFanqieList.list.push(1);
                    this.nowFanqieList.fanqietotal += this.workTimeNum;

                    this.fullFanqieList[this.fullFanqieList.length - 1] = this.nowFanqieList

                    //再清空
                    this.nowFanqieList = [];
                    this.timeshow = this.padNumberToTwoDigits(this.restNum) + ':00';
                    $(".c1").animate({
                        height: 0 + "%"
                    }, 0);
                    $(".c2").animate({
                        height: 0 + "%"
                    }, 0);
                    this.totalSeconds = this.restNum * 60;
                    this.clockstatus = 3;
                    timer = setInterval(this.updateRestCountdown, 1);
                }
            },
            updateRestCountdown() {

                var minutes = Math.floor(this.totalSeconds / 60); // 计算分钟数
                var seconds = this.totalSeconds % 60; // 计算剩余的秒数
                // 确保秒数是两位数
                seconds = seconds < 10 ? '0' + seconds : seconds;
                // 更新页面上的显示
                minutes = minutes < 10 ? '0' + minutes : minutes;
                this.timeshow = minutes + ':' + seconds;
                let persent = (this.restNum * 60 - this.totalSeconds) * 100 / (this.restNum * 60)
                $(".c2").animate({
                    height: persent + "%"
                }, 0);
                // 减少总秒数
                this.totalSeconds--;
                // 如果倒计时结束，可以清除定时器或进行其他操作
                if (this.totalSeconds < 0) {
                    clearInterval(timer);
                    // 这里可以添加倒计时结束后的处理逻辑
                    //请求后端

                    //获取最新一个
                    // this.nowFanqieList = this.fullFanqieList[this.fullFanqieList.length-1]
                    // this.nowFanqieList.list.push(1);
                    // this.nowFanqieList.fanqietotal +=  this.workTimeNum;
                    // this.fullFanqieList[this.fullFanqieList.length-1] = this.nowFanqieList
                    //
                    // //再清空
                    // this.nowFanqieList = [];

                    $(".c1").animate({
                        height: 0 + "%"
                    }, 0);
                    $(".c2").animate({
                        height: 0 + "%"
                    }, 0);

                    this.timeshow = this.padNumberToTwoDigits(this.workTimeNum) + ':00';
                    this.totalSeconds = this.workTimeNum * 60;
                    this.clockstatus = 2
                    timer = setInterval(this.updateWorkCountdown, 1);

                }
            },
            startCount() {

                if (!this.inputContent.trim()) {
                    this.$message.error("请输入目标");
                    return
                }

                if (this.clockstatus == 1) {
                    this.totalSeconds = this.workTimeNum * 60;
                    this.clockstatus = 2;
                    this.titleDisabled = true;
                    this.countDisable = true;
                    $(".c1").animate({
                        height: 0 + "%"
                    }, 0);
                    $(".c2").animate({
                        height: 0 + "%"
                    }, 0);
                    this.nowFanqieList = {
                        title: '',
                        list: [],
                        fanqietotal: 0,
                        lantotal: 0
                    }
                    this.nowFanqieList.title = this.inputContent
                    this.fullFanqieList.push(this.nowFanqieList)
                    timer = setInterval(this.updateWorkCountdown, 1);
                } else if (this.clockstatus == 2) {
                    //弹窗
                    Swal.fire({
                        title: "是否提前结束",
                        html: '<div class="text-sm">提示：现在结束会变成烂番茄，结束整个番茄时间流程</div>' +

                            '                </div>',
                        showCloseButton: true,
                        showCancelButton: true,
                        confirmButtonText: "结&nbsp;&nbsp;束",
                        cancelButtonText: "取&nbsp;&nbsp;消",
                        focusConfirm: false,
                        heightAuto: false,
                        customClass: {
                            // 宽度不要改了，高度可以再微调，注意：popup和htmlContainer相差一百
                            popup: 'w-[95%] md:w-[60%] max-w-[300px] max-h-[600px]',
                            htmlContainer: 'max-h-[500px]',
                        }
                    }).then((result) => {
                        /* Read more about isConfirmed, isDenied below */
                        if (result.isConfirmed) {
                            clearInterval(timer);

                            // 这里可以添加倒计时结束后的处理逻辑
                            //录入番茄数

                            this.nowFanqieList = this.fullFanqieList[this.fullFanqieList.length - 1];

                            this.nowFanqieList.title = this.inputContent
                            this.nowFanqieList.list.push(0)
                            this.nowFanqieList.lantotal += this.workTimeNum - Math.floor((this.totalSeconds) / 60);
                            this.fullFanqieList[this.fullFanqieList.length - 1] = this.nowFanqieList


                            this.uploadData(this.nowFanqieList)

                            //复位
                            $(".c1").animate({
                                height: 0 + "%"
                            }, 0);
                            $(".c2").animate({
                                height: 0 + "%"
                            }, 0);

                            this.timeshow = this.padNumberToTwoDigits(this.workTimeNum) + ':00';
                            this.totalSeconds = this.workTimeNum * 60;
                            this.clockstatus = 1
                            this.titleDisabled = false
                            this.countDisable = false
                            this.nowFanqieList = {
                                title: '',
                                list: [],
                                fanqietotal: 0,
                                lantotal: 0
                            }
                            Swal.close();
                        } else {

                            this.countDisable = false;
                            this.titleDisabled = false;
                            Swal.close();
                        }
                    });

                } else if (this.clockstatus == 3) {
                    //弹窗
                    Swal.fire({
                        title: "是否提前结束休息",
                        html: '<div class="text-sm">提示：现在结束休息会结束整个番茄时间流程</div>' +

                            '                </div>',
                        showCloseButton: true,
                        showCancelButton: true,
                        confirmButtonText: "结&nbsp;&nbsp;束",
                        cancelButtonText: "取&nbsp;&nbsp;消",
                        focusConfirm: false,
                        heightAuto: false,
                        customClass: {
                            // 宽度不要改了，高度可以再微调，注意：popup和htmlContainer相差一百
                            popup: 'w-[95%] md:w-[60%] max-w-[300px] max-h-[600px]',
                            htmlContainer: 'max-h-[500px]',
                        }
                    }).then((result) => {
                        /* Read more about isConfirmed, isDenied below */
                        if (result.isConfirmed) {
                            clearInterval(timer);
                            let list = this.fullFanqieList[this.fullFanqieList.length - 1]
                            this.uploadData(list)
                            $(".c1").animate({
                                height: 0 + "%"
                            }, 0);
                            $(".c2").animate({
                                height: 0 + "%"
                            }, 0);
                            // 这里可以添加倒计时结束后的处理逻辑
                            this.timeshow = this.padNumberToTwoDigits(this.workTimeNum) + ':00';
                            this.totalSeconds = this.workTimeNum * 60;
                            this.clockstatus = 1

                            Swal.close();
                        } else {
                            this.countDisable = false;
                            this.titleDisabled = false;

                            Swal.close();
                        }
                    });
                }
            },
            handleVisibilityChange() {
                if (document.visibilityState === 'visible') {
                    console.log('页面可见，可以视为 onShow');
                } else if (document.visibilityState === 'hidden') {
                    console.log("切换到后台");
                    if (this.clockstatus == 2) {
                        clearInterval(timer);
                        this.nowFanqieList = this.fullFanqieList[this.fullFanqieList.length - 1];

                        this.nowFanqieList.title = this.inputContent
                        this.nowFanqieList.list.push(0)
                        this.nowFanqieList.lantotal += this.workTimeNum - Math.floor((this.totalSeconds) / 60);
                        this.fullFanqieList[this.fullFanqieList.length - 1] = this.nowFanqieList

                        this.uploadData(this.nowFanqieList)

                        //复位
                        $(".c1").animate({
                            height: 0 + "%"
                        }, 0);
                        $(".c2").animate({
                            height: 0 + "%"
                        }, 0);

                        this.timeshow = this.padNumberToTwoDigits(this.workTimeNum) + ':00';
                        this.totalSeconds = this.workTimeNum * 60;
                        this.clockstatus = 1
                        this.titleDisabled = false
                        this.countDisable = false
                        this.nowFanqieList = {
                            title: '',
                            list: [],
                            fanqietotal: 0,
                            lantotal: 0
                        }
                    } else if (this.clockstatus == 3) {
                        clearInterval(timer);
                        let list = this.fullFanqieList[this.fullFanqieList.length - 1]
                        this.uploadData(list)
                        $(".c1").animate({
                            height: 0 + "%"
                        }, 0);
                        $(".c2").animate({
                            height: 0 + "%"
                        }, 0);
                        // 这里可以添加倒计时结束后的处理逻辑
                        this.timeshow = this.padNumberToTwoDigits(this.workTimeNum) + ':00';
                        this.totalSeconds = this.workTimeNum * 60;
                        this.clockstatus = 1
                    }
                }
            },
            padNumberToTwoDigits(num) {
// 将数字转换为字符串
                let strNum = num.toString();
// 使用padStart方法补零，直到长度为2
// 如果已经是两位数或更多位数，则不会改变
                return strNum.padStart(2, '0');
            },
            uploadData(content) {
                axios({
                    url: this.baseUrl + "/webapp/fanqie/add",
                    method: "post",
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + this.token
                    },
                    data: {
                        title: content.title,
                        fanqietime: content.fanqietotal,
                        lantime: content.lantotal,
                        list: JSON.stringify(content.list)
                    }
                }).then(({data}) => {
                    if (data && data.code === 200) {

                    } else {
                        this.$message.error(data.msg);

                    }
                })
            }
        },
        created() {

        },
        mounted() {
            document.addEventListener('visibilitychange', this.handleVisibilityChange);
        },
        beforeDestroy() {
            document.removeEventListener('visibilitychange', this.handleVisibilityChange);
        },
    })


</script>

<style>
    .r_out {
        width: 200px;
        height: 200px;
        border: 8px solid #d9d9d9;
        background: #fff;
        box-shadow: 3px 3px 5px #bfbfbf;
        -webkit-box-shadow: 3px 3px 5px #bfbfbf;
        -moz-box-shadow: 3px 3px 5px #bfbfbf;
        -ms-box-shadow: 3px 3px 5px #bfbfbf;
        border-radius: 50%;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        -ms_border-radius: 50%;
        display: inline-block;

        position: relative;
    }

    .r_out p {
        position: absolute;
        bottom: -50px;
        color: #000;
        text-align: center;
        margin: 0 auto;
        width: 100%;
        font-size: 16px;
        line-height: 1.5;
        font-weight: bold;
    }


    .r_in {
        width: 180px;
        height: 180px;
        border: 10px solid #fff;
        border-radius: 50%;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        -ms_border-radius: 50%;
        overflow: hidden;
        position: relative;
    }

    .r_c {
        width: 180px;
        height: 180px;
        position: absolute;
        bottom: 0;
        left: 0;
        height: 0;
    }

    .c1 {
        background: #fbad4c;
    }

    .c2 {
        background: #5fc234;
    }

    .r_num {
        color: #404040;
        font-size: 40px;
        line-height: 1.5;
        font-weight: bold;
        position: absolute;
        top: 50%;
        margin-top: -25px;
        text-align: center;
        width: 100%;
    }

    .inlineblock {
        display: inline-block;
        vertical-align: middle; /* 确保图片和文本垂直居中 */
    }

</style>

</body>

</html>
